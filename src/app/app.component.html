
<header class="size-full max-h-16 shadow-md flex justify-center">
  <div class="flex justify-between gap-2 items-center w-full">
    <div class="flex ml-3 gap-2">
      <input nz-input placeholder="username"  type="text" [(ngModel)]="hostName"/>
      <button nz-button nzType="primary" (click)="createRoom()" [nzLoading]="isLoading">Create a room</button>
    </div>
    <div class="flex mr-3 gap-2">
      <input nz-input placeholder="username"  type="text" [(ngModel)]="remoteUsername"/>
      <input type="text" placeholder="room number..." nz-input [(ngModel)]="roomId"/>
      <button nz-button nzType="primary" (click)="joinAsRemoteRoom()" [nzLoading]="isJoining">Join a room</button>
    </div>
  </div>
</header>

<div id="container" class="bg-[red]"></div>
<div class="flex flex-wrap items-center m-3 gap-3">
  <div>
    @if (localVideo.srcObject) {
      <h1>{{hostName || remoteUsername}}</h1>
    }
    <video autoPlay playsInline #localVideo class="w-[372px] h-[280px] rounded-md"></video>
    <canvas  #localCanvas class="w-[372px] h-[280px] rounded-md hidden"></canvas>
    @if (localVideo.srcObject) {
      <div class="flex gap-1">
        <button nz-button nzType="primary" (click)="toggleLocalUserMic()" nz-tooltip class="w-full"><i class="pi pi-microphone text-[20px]"></i></button>
        <button nz-button nzType="primary" (click)="toggleLocalUserCam()" class="w-full"><i class="pi pi-camera text-[20px]"></i></button>
        <button nz-button nzType="primary" class="w-full" (click)="shareScreen()"><i class="pi pi-desktop text-[20px]"></i></button>
        <button nz-button nzType="primary" class="w-full"><i class="pi pi-sign-out text-[20px]"></i></button>
        <button nz-button
                nzType="primary"
                nz-popover
                nzPopoverTitle="Virtual background"
                [(nzPopoverVisible)]="visible"
                nzPopoverTrigger="click"
                [nzPopoverContent]="contentTemplate">
                <i class="pi pi-image text-[20px]"></i>
        </button>
        <ng-template #contentTemplate>
           <div class="flex flex-col">
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(0)">No blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(5)">Low blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(10)">Mid blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(15)">High blur</button>
             <button nz-button nzType="default" class="w-full" (click)="setBackgroundImage()">Image</button>
           </div>
        </ng-template>
      </div>
    }
  </div>
  @for (item of remoteUserStream; track $index) {
    <div>
      <h1>{{item.name}}</h1>
      <video autoPlay
             #remoteVideo
             playsInline
             [srcObject]="item.stream"
             class="w-[372px] h-[280px] rounded-md"
             [ngClass]="{'outline-2 outline-double outline-blue-800': item.talking}"></video>
      <div class="flex gap-1">
        <button nz-button nzType="primary" class="w-full"><i class="pi pi-microphone text-[20px]"></i></button>
        <button nz-button nzType="primary" class="w-full"><i class="pi pi-camera text-[20px]"></i></button>
        <button nz-button nzType="primary" class="w-full"><i class="pi pi-desktop text-[20px]"></i></button>
        <button nz-button nzType="primary" class="w-full"><i class="pi pi-sign-out text-[20px]"></i></button>
        <button nz-button
                nzType="primary"
                nz-popover
                nzPopoverTitle="Virtual background"
                [(nzPopoverVisible)]="visible"
                nzPopoverTrigger="click"
                [nzPopoverContent]="contentTemplate">
                <i class="pi pi-image text-[20px]"></i>
        </button>
        <ng-template #contentTemplate>
           <div class="flex flex-col">
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(0)">No blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(5)">Low blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(10)">Mid blur</button>
             <button nz-button nzType="default" class="w-full" (click)="handleVirtualBackground(15)">High blur</button>
             <button nz-button nzType="default" class="w-full" (click)="setBackgroundImage()">Image</button>
           </div>
        </ng-template>
      </div>
    </div>
  }
</div>

@if (isScreenShare) {
  <div class="absolute bottom-5 right-5 bg-black rounded">
    <i class="cursor-pointer z-10 pi pi-stop-circle absolute right-[10px] top-[10px] p-[5px] rounded bg-white text-red-600" (click)="stopShareScreen()"></i>
    <i class="cursor-pointer z-10 pi pi-expand absolute right-[40px] top-[10px] p-[5px] rounded bg-white text-red-600"></i>
    <video autoPlay playsInline #screenShare class="w-[372px] h-[280px] rounded-md"></video>
  </div>
}


